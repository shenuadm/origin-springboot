# ===========================================
# 微服务模式专属配置
# ===========================================
spring:
  application:
    name: "技术底座微服务版"
  # 微服务模式使用响应式 Web 应用类型（Spring Cloud Gateway要求）
  main:
    web-application-type: reactive
    # 允许 bean 定义覆盖，解决 Security 配置冲突
    allow-bean-definition-overriding: true
  autoconfigure:
    exclude:
      # 排除 Spring MVC 的 Security 自动配置
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration
      # 排除 Spring MVC 的 Actuator 安全自动配置
      - org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration
      # 排除 WebSocket 自动配置（微服务模式下使用响应式 WebSocket）
      - org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration
      - com.cosmos.origin.websocket.config.WebSocketAutoConfiguration
      # 排除 Spring Cloud Gateway 的 Redis 限流自动配置（使用自定义限流方案）
      - org.springframework.cloud.gateway.config.GatewayRedisAutoConfiguration
  cloud:
    nacos:
      discovery:
        enabled: true
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
      config:
        enabled: true
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        file-extension: yaml
        import-check:
          enabled: false
    gateway:
      server:
        webflux:
          enabled: true
          discovery:
            locator:
              enabled: true
              lower-case-service-id: true

# ===========================================
# 微服务模式禁用部分单体功能
# ===========================================
origin:
  gateway:
    # 微服务模式下限流通过 Gateway 过滤器实现
    rate-limit:
      enabled: false
